<!DOCTYPE html>
<html lang="da">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crossfit in the Backyard 2025</title>
    <style>
        :root {
            --primary-bg: #1a1a1a;
            --secondary-bg: #2b2b2b;
            --text-color: #e0e0e0;
            --accent-color: #00bcd4;
            --danger-color: #f44336;
            --success-color: #4CAF50;
            --warning-color: #ff9800;
            --font-main: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        body {
            font-family: var(--font-main);
            background-color: var(--primary-bg);
            color: var(--text-color);
            margin: 0;
            padding: 1rem;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            text-align: center;
        }
        .container {
            width: 100%;
            max-width: 500px;
        }
        h1, h2, h3 {
            margin-top: 0;
        }
        .hidden {
            display: none !important;
        }

        /* --- Setup Screen --- */
        #setup {
            background-color: var(--secondary-bg);
            padding: 2rem;
            border-radius: 15px;
        }
        #setup h2 {
            margin-bottom: 1.5rem;
        }
        label {
            display: block;
            margin-bottom: 0.5rem;
            font-size: 1.1rem;
            text-align: left;
        }
        select, input[type="number"] {
            width: 100%;
            padding: 0.8rem;
            margin-bottom: 1rem;
            border-radius: 8px;
            border: 1px solid #444;
            background-color: #333;
            color: var(--text-color);
            font-size: 1.2rem;
            box-sizing: border-box;
        }
        .interval-setting {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }
        .interval-setting label {
            flex-basis: 70%;
            text-align: left;
            margin: 0;
            font-size: 1rem;
        }
        .interval-setting input {
            flex-basis: 25%;
            margin: 0;
            padding: 0.5rem;
        }

        /* --- Time Summary --- */
        #time-validation-summary {
            background-color: #333;
            border-radius: 8px;
            padding: 1rem;
            margin-top: 1.5rem;
            margin-bottom: 1.5rem;
            text-align: left;
            font-size: 1.1rem;
        }
        #time-validation-summary p {
            margin: 0.5rem 0;
            display: flex;
            justify-content: space-between;
        }
        #time-validation-summary span {
            font-weight: bold;
        }
        .summary-match { color: var(--success-color); }
        .summary-over { color: var(--danger-color); }
        .summary-under { color: var(--warning-color); }


        button {
            width: 100%;
            padding: 1rem;
            font-size: 1.5rem;
            font-weight: bold;
            color: white;
            background-color: var(--accent-color);
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        button:hover {
            background-color: #0097a7;
        }
        button.danger {
             background-color: var(--danger-color);
        }
        button.danger:hover {
            background-color: #d32f2f;
        }
        
        /* --- Timer Screen --- */
        #timer {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: black;
            display: flex;
            flex-direction: column;
            justify-content: space-around;
            align-items: center;
            z-index: 100;
        }
        #current-round {
            font-size: 2rem;
            color: #aaa;
            margin: 0;
        }
        #current-exercise {
            font-size: 3rem;
            margin: 0 1rem;
        }
        #remaining-reps {
            font-size: 1.5rem;
            color: #aaa;
            margin: 0.5rem 0;
        }
        #countdown {
            font-family: Roboto;
            font-size: 10rem;
            font-weight: bold;
            color: var(--accent-color);
        }
        #timer-controls {
            width: 100%;
            padding: 0 1rem;
            box-sizing: border-box;
        }
        #timer-controls button {
            margin-top: 1rem;
        }
    </style>
</head>
<body>

    <div class="container">
        <div id="setup">
            <h2>Workout Timer Setup</h2>
            <label for="workout-select">1. V√¶lg din workout:</label>
            <select id="workout-select">
                <option value="">-- V√¶lg her --</option>
                <option value="workout1">Workout 1</option>
                <option value="workout2">Workout 2</option>
                <option value="run">L√∏b (4 runder)</option>
            </select>
            
            <div id="total-time-container" class="hidden">
                <label for="total-time-input">2. √ònsket totaltid (minutter):</label>
                <input type="number" id="total-time-input" min="1">
            </div>

            <div id="intervals-container"></div>
            
            <div id="time-validation-summary" class="hidden"></div>

            <button id="start-btn" class="hidden">Start Workout</button>
        </div>

        <div id="timer" class="hidden">
            <div>
                <h3 id="current-round"></h3>
                <h2 id="current-exercise"></h2>
                <div id="remaining-reps"></div>
            </div>
            <div id="countdown">00:00</div>
            <div id="timer-controls">
                <button id="end-btn" class="danger">Afslut Workout</button>
            </div>
        </div>
    </div>

    <script>
        // --- DATA ---
        const workouts = {
            workout1: {
                rounds: 4,
                exercises: ["30 DB Snatch", "15 Sit ups", "30 DB Goblet squats", "12 Mt. Climbers", "30 DB Shoulder to overhead", "9 Burpees"],
                reps: [30, 15, 30, 12, 30, 9],
                baselineMinutes: 52,
                baselineIntervals: [240, 70, 190, 30, 190, 60]
            },
            workout2: {
                rounds: 4,
                exercises: ["30 DB Deadlift", "10 DB Devils Press", "30 V-ups", "30 DB High pulls", "30 Pike leg lifts over DB"],
                reps: [30, 10, 30, 30, 30],
                baselineMinutes: 52,
                baselineIntervals: [120, 160, 200, 170, 130]
            },
            run: {
                rounds: 4,
                exercises: ["L√∏b om s√∏en"],
                reps: [1],
                baselineMinutes: 52,
                baselineIntervals: [780]
            }
        };

        // --- DOM ELEMENTS ---
        const setupScreen = document.getElementById('setup'), timerScreen = document.getElementById('timer');
        const workoutSelect = document.getElementById('workout-select');
        const totalTimeContainer = document.getElementById('total-time-container');
        const totalTimeInput = document.getElementById('total-time-input');
        const intervalsContainer = document.getElementById('intervals-container');
        const validationSummary = document.getElementById('time-validation-summary');
        const startBtn = document.getElementById('start-btn'), endBtn = document.getElementById('end-btn');
        const currentRoundDisplay = document.getElementById('current-round'), currentExerciseDisplay = document.getElementById('current-exercise'), countdownDisplay = document.getElementById('countdown');
        const remainingRepsDisplay = document.getElementById('remaining-reps');

        // --- STATE ---
        let selectedWorkout, intervalDurations = [], currentExerciseIndex = 0, currentRound = 1, countdownInterval, timeLeft = 0;
        const beepSound = new Audio("data:audio/wav;base64,UklGRl9vT19XQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YU=" + "9vT19".repeat(20));

        // --- FUNCTIONS ---
        function formatTime(totalSeconds, includeSign = false) {
            if (isNaN(totalSeconds)) return "00:00";
            const sign = totalSeconds < 0 ? "-" : (includeSign ? "+" : "");
            const absSeconds = Math.abs(totalSeconds);
            const mins = Math.floor(absSeconds / 60);
            const secs = absSeconds % 60;
            return `${sign}${String(mins).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
        }
        
        function adjustIntervalsBasedOnTotalTime() {
            if (!selectedWorkout.baselineMinutes) return;

            const newTotalMinutes = parseInt(totalTimeInput.value, 10);
            if (isNaN(newTotalMinutes) || newTotalMinutes <= 0) return;

            const ratio = newTotalMinutes / selectedWorkout.baselineMinutes;
            const intervalInputs = document.querySelectorAll('.interval-input');

            intervalInputs.forEach((input, index) => {
                const newIntervalValue = Math.round(selectedWorkout.baselineIntervals[index] * ratio);
                input.value = newIntervalValue;
            });

            updateValidationSummary();
        }

        function updateValidationSummary() {
            const desiredTotalMinutes = parseInt(totalTimeInput.value, 10);
            if (isNaN(desiredTotalMinutes) || desiredTotalMinutes <= 0) {
                validationSummary.classList.add('hidden');
                return;
            }

            const desiredTotalSeconds = desiredTotalMinutes * 60;
            const currentIntervalInputs = document.querySelectorAll('.interval-input');
            const timePerRound = Array.from(currentIntervalInputs).reduce((sum, input) => sum + (parseInt(input.value, 10) || 0), 0);
            const calculatedTotalSeconds = timePerRound * selectedWorkout.rounds;
            const difference = calculatedTotalSeconds - desiredTotalSeconds;

            let diffClass = 'summary-match';
            if (difference > 5 || difference < -5) { // Allow small rounding difference
                 diffClass = difference > 0 ? 'summary-over' : 'summary-under';
            }

            validationSummary.innerHTML = `
                <p>√ònsket tid: <span>${formatTime(desiredTotalSeconds)}</span></p>
                <p>Beregnet tid: <span>${formatTime(calculatedTotalSeconds)}</span></p>
                <p>Difference: <span class="${diffClass}">${formatTime(difference, true)}</span></p>
            `;
            validationSummary.classList.remove('hidden');
        }

        function populateIntervals(workoutKey) {
            totalTimeInput.value = '';
            intervalsContainer.innerHTML = '';
            validationSummary.classList.add('hidden');
            
            if (!workoutKey) {
                totalTimeContainer.classList.add('hidden');
                startBtn.classList.add('hidden');
                return;
            }

            selectedWorkout = workouts[workoutKey];
            totalTimeContainer.classList.remove('hidden');
            intervalsContainer.innerHTML = '<h3>3. Juster tid pr. √∏velse (sekunder):</h3>';

            selectedWorkout.exercises.forEach((exercise, index) => {
                const div = document.createElement('div');
                div.className = 'interval-setting';
                const label = document.createElement('label');
                label.setAttribute('for', `interval-${index}`);
                label.textContent = exercise;
                const input = document.createElement('input');
                input.type = 'number';
                input.id = `interval-${index}`;
                input.className = 'interval-input';
                // --- SMART DEFAULTS ---
                if (selectedWorkout.baselineIntervals) {
                    input.value = selectedWorkout.baselineIntervals[index];
                } else {
                    input.value = 60; // Fallback for other workouts
                }
                input.min = 1;
                div.appendChild(label);
                div.appendChild(input);
                intervalsContainer.appendChild(div);
            });

            if (selectedWorkout.baselineMinutes) {
                totalTimeInput.value = selectedWorkout.baselineMinutes;
            }

            startBtn.classList.remove('hidden');
            updateValidationSummary();
        }

        function startTimer() {
            const inputs = document.querySelectorAll('.interval-input');
            intervalDurations = Array.from(inputs).map(input => parseInt(input.value, 10));
            setupScreen.classList.add('hidden');
            timerScreen.classList.remove('hidden');
            currentExerciseIndex = 0;
            currentRound = 1;
            runNextInterval();
        }

        function runNextInterval() {
            clearInterval(countdownInterval);
            if (currentExerciseIndex >= selectedWorkout.exercises.length) {
                currentExerciseIndex = 0;
                currentRound++;
            }
            if (currentRound > selectedWorkout.rounds) {
                workoutComplete();
                return;
            }

            currentRoundDisplay.textContent = `Runde ${currentRound} / ${selectedWorkout.rounds}`;
            currentExerciseDisplay.textContent = selectedWorkout.exercises[currentExerciseIndex];
            timeLeft = intervalDurations[currentExerciseIndex];
            countdownDisplay.textContent = formatTime(timeLeft);
            
            // Calculate reps per second for this exercise
            const totalReps = selectedWorkout.reps[currentExerciseIndex];
            const totalTime = intervalDurations[currentExerciseIndex];
            const repsPerSecond = totalReps / totalTime;
            
            // Update remaining reps display
            function updateRemainingReps() {
                const remainingReps = Math.max(0, Math.ceil(timeLeft * repsPerSecond));
                if (selectedWorkout.exercises[currentExerciseIndex].includes('L√∏b')) {
                    remainingRepsDisplay.textContent = '';
                } else {
                    remainingRepsDisplay.textContent = `${remainingReps} reps tilbage`;
                }
            }
            
            updateRemainingReps();
            
            countdownInterval = setInterval(() => {
                timeLeft--;
                countdownDisplay.textContent = formatTime(timeLeft);
                updateRemainingReps();
                if (timeLeft <= 0) {
                    beepSound.play();
                    currentExerciseIndex++;
                    runNextInterval();
                }
            }, 1000);
        }
        
        function workoutComplete() {
            clearInterval(countdownInterval);
            currentRoundDisplay.textContent = 'F√¶rdig!';
            currentExerciseDisplay.textContent = 'Godt klaret! üí™';
            remainingRepsDisplay.textContent = '';
            countdownDisplay.textContent = "‚úî";
            countdownDisplay.style.color = 'var(--success-color)';
        }

        function endWorkout() {
            clearInterval(countdownInterval);
            timerScreen.classList.add('hidden');
            setupScreen.classList.remove('hidden');
            countdownDisplay.style.color = 'var(--accent-color)';
        }

        // --- EVENT LISTENERS ---
        workoutSelect.addEventListener('change', (e) => populateIntervals(e.target.value));
        totalTimeInput.addEventListener('input', adjustIntervalsBasedOnTotalTime);
        intervalsContainer.addEventListener('input', updateValidationSummary);
        startBtn.addEventListener('click', startTimer);
        endBtn.addEventListener('click', endWorkout);
    </script>
</body>
</html>